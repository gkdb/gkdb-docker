version: '3'
#networks:
#  isolated:
#    driver: bridge
#    ipam:
#      config:
#        - subnet: 172.31.0.0/16
#          gateway: 172.31.0.1
#    driver_opts:
#      com.docker.network.bridge.enable_icc: "false"
#      com.docker.network.bridge.enable_ip_masquerade: "false"
#  trusted:
#    driver: bridge
#    ipam:
#      config:
#        - subnet: 172.32.0.0/16
services:
  postgres-server:
    build: ./postgres_server
    hostname: postgres_server
    ports:
      - "5432:5432"
#    networks:
#      - isolated
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - LDAP_ADMIN_PASSWORD=${LDAP_ADMIN_PASSWORD}
      - POSTGRES_INITDB_ARGS="--auth-host=md5"
  adminer:
    image: adminer
#    networks:
#      - isolated
    ports:
      - "8080:8080"
  ldap-server:
    build: ./openldap
    hostname: ldap_server
#    networks:
#      - isolated
    ports:
      - "389:389"
      - "636:636"
    environment:
      - LDAP_ADMIN_PASSWORD=${LDAP_ADMIN_PASSWORD}
      - LDAP_CONFIG_PASSWORD=${LDAP_ADMIN_PASSWORD}
  phpldapadmin:
    build: ./phpldapadmin
    hostname: phpldapadmin
    ports:
      - "80:80"
#    networks:
#      - isolated
  syncer:
    build: ./syncer
#    networks:
#      - isolated
    environment:
      - PGPASSWORD=${LDAP_ADMIN_PASSWORD}
      - PGUSER=admin
      - LDAP_ADMIN_PASSWORD=${LDAP_ADMIN_PASSWORD}
      - LDAP_ADMIN_USER=admin
  jupyterhub:
    build: ./jupyterhub
    hostname: jupyterhub
#    networks:
#      - isolated
    ports:
      - "8000:8000"

#docker run --name ldap-service --hostname ldap-service --detach osixia/openldap:1.1.8
#docker run -p 80:80 --name phpldapadmin-service --hostname phpldapadmin-service --link ldap-service:ldap-host --env PHPLDAPADMIN_HTTPS=false --env PHPLDAPADMIN_LDAP_HOSTS=ldap-host --detach osixia/phpldapadmin:0.6.12
